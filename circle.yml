machine:
  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
  node:
    version: 8.9.4

dependencies:
  pre:
    - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" >> ~/.npmrc

test:
  override:
    - if [[ $CIRCLE_BRANCH != "releases" ]] ; then npm test ; fi

deployment:
 master:
   branch: master
   commands:
     - npm run copy-files-to-dist
     - npm run build
     - npm run deploy
     - npm run deploy:demo
 releases:
   branch: releases
   commands:
     - npm run release-to-github
     - npm publish --access=public

general:
  branches:
    ignore:
      - gh-pages
