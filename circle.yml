machine:
  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
  node:
    version: 8.9.4

dependencies:
  pre:
    - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" >> ~/.npmrc

test:
  override:
    - if [[ $CIRCLE_BRANCH != "releases" ]] ; then npm test ; fi

deployment:
 master:
   branch: master
   commands:
     - npm run copy-files-to-dist
     - npm run build
     - npm run deploy
 releases:
   branch: releases
   commands:
     - npm run release-to-github
     - npm publish
     - git clone git@github.com:transferwise/styleguide-components.git gh-pages
     - npm run copy:ghpages
     - cd gh-pages
     - git checkout gh-pages
     - git add .
     - git commit -m "Update docs"
     - git push origin gh-pages
