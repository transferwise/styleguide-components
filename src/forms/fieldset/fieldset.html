<fieldset ng-form="twFieldset">
  <legend ng-if="$ctrl.legend">{{ $ctrl.legend }}</legend>
  <p class="text-max-width" ng-if="$ctrl.description">{{ $ctrl.description }}</p>
  <div class="row row-equal-height">
    <div ng-repeat="field in $ctrl.fields track by $index" class="col-xs-12" ng-hide="field.hidden"
      ng-class="{
        'col-sm-4': !$ctrl.narrow  && field.width === 'sm',
        'col-sm-6': !$ctrl.narrow  && (field.width === 'md' || field.maxlength && field.maxlength <= 10),
        'col-sm-12': $ctrl.narrow || field.width === 'lg' || !field.maxlength || field.maxlength > 10
      }">
      <tw-field
        model="$ctrl.model[field.key]"
        options="field"
        locale="$ctrl.locale"
        upload-options="$ctrl.uploadOptions"
        error-message="$ctrl.errorMessages[field.key]">
      </tw-field>
      <!--
      ng-blur="$ctrl.onBlur(field)"
      ng-change="$ctrl.onChange(field)"
      -->
      <!--
      <div class="form-group tw-field-{{field.key}}"
        ng-class="{
          'has-error': $ctrl.errorMessages[field.key]
        }">
        <label class="control-label"
          ng-if="field.type !== 'upload'">
          {{field.name}}
        </label>

        <div ng-if="!field.group">
          <tw-form-control
            name="{{ field.key }}"
            label="{{ field.name }}"
            type="{{ field.type | lowercase }}"
            format="{{ field.format | lowercase }}"
            placeholder="{{ field.placeholder || field.example }}"
            help-text="{{ field.helpText }}"
            help-image="{{ field.helpImage }}"
            locale="{{ $ctrl.locale }}"
            upload-accept="{{ field.accept }}"
            upload-icon="{{ field.icon }}"
            upload-too-large-message="{{ field.tooLargeMessage }}"
            options="field.valuesAllowed"
            upload-options="$ctrl.uploadOptions"
            ng-model="$ctrl.model[field.key]"
            ng-blur="$ctrl.onBlur(field)"
            ng-change="$ctrl.onChange(field)"
            ng-required="field.required"
            ng-disabled="field.disabled"
            tw-minlength="field.minLength"
            tw-maxlength="field.maxLength"
            ng-min="field.min || field.minimum"
            ng-max="field.max || field.maximum"
            ng-pattern="field.validationRegexp || field.pattern"
            text-format="field.displayFormat"
            tw-validation
          ></tw-form-control>
          <div class="alert alert-danger error-messages"
            ng-class="{'alert-detach': field.type === 'date' || field.type === 'upload'}">
            <div ng-repeat="(validationType, validationMessage) in field.validationMessages track by $index"
              class="error-{{validationType}}">
              {{validationMessage}}
            </div>
            <div class="error-provided" ng-if="$ctrl.errorMessages[field.key]">
              {{ $ctrl.errorMessages[field.key] }}
            </div>
          </div>
          <div ng-if="field.tooltip || field.helpText || field.helpList || field.helpImage"
            class="alert alert-focus"
            ng-class="{'alert-detach': field.type === 'date' || field.type === 'upload'}">
            <span ng-if="field.tooltip || field.helpText">
              {{ field.tooltip || field.helpText }}
            </span>
            <ul ng-if="field.helpList" class="list-unstyled">
              <li ng-repeat="helpMessage in field.helpList">{{ helpMessage }}</li>
            </ul>
            <img
              ng-if="field.helpImage && field.type !== 'upload'"
              ng-src="{{field.helpImage}}"
              alt="{{field.name}}"
              class="thumbnail m-y-2" />
          </div>
        </div>
        -->

        <!-- Start old format -->
        <div class="row" ng-if="field.group">
          <div class="col-xs-{{field.columns}}"
            ng-repeat="fieldSection in field.group track by $index">
            <tw-form-control
              name="{{fieldSection.key}}"
              label="{{field.name}}"
              type="{{fieldSection.type | lowercase}}"
              placeholder="{{fieldSection.placeholder || fieldSection.example}}"
              help-text="{{fieldSection.helpText}}"
              help-image="{{fieldSection.helpImage}}"
              locale="{{$ctrl.locale}}"
              upload-accept="{{fieldSection.accept}}"
              upload-icon="{{fieldSection.icon}}"
              upload-too-large-message="{{fieldSection.tooLargeMessage}}"
              options="fieldSection.valuesAllowed"
              upload-options="$ctrl.uploadOptions"
              ng-model="$ctrl.model[fieldSection.key]"
              ng-blur="$ctrl.onBlur(field)"
              ng-change="$ctrl.onChange(field)"
              ng-required="fieldSection.required"
              ng-disabled="fieldSection.disabled"
              tw-minlength="fieldSection.minLength"
              tw-maxlength="fieldSection.maxLength"
              ng-min="fieldSection.min || fieldSection.minimum"
              ng-max="fieldSection.max || fieldSection.maximum"
              ng-pattern="fieldSection.validationRegexp || fieldSection.pattern"
              text-format="fieldSection.displayFormat"
              tw-validation
            ></tw-form-control>
            <div class="alert alert-danger error-messages"
              ng-class="{'alert-detach': fieldSection.type === 'date' || fieldSection.type === 'upload'}">
              <div ng-repeat="(validationType, validationMessage) in fieldSection.validationMessages"
                class="error-{{validationType}}">
                {{validationMessage}}
              </div>
              <div class="error-provided" ng-if="$ctrl.errorMessages[fieldSection.key]">
                {{ $ctrl.errorMessages[fieldSection.key] }}
              </div>
            </div>
            <div ng-if="fieldSection.tooltip || fieldSection.helpText"
              class="alert alert-focus"
              ng-class="{'alert-detach': fieldSection.type === 'date' || fieldSection.type === 'upload'}">
              {{ fieldSection.tooltip || fieldSection.helpText}}
            </div>
            <img
              ng-if="fieldSection.helpImage && fieldSection.type !== 'upload'"
              ng-src="fieldSection.helpImage"
              alt="{{field.name}}"
              class="thumbnail m-t-2 m-b-0" />
          </div>
          <!-- End old format -->
        </div>
      </div>
    </div>
  </div>
</fieldset>
